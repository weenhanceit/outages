<h1>
  List of Outages of Interest to the User
  <br/>
  <small>
    User's home Page
  </small>
</h1>
<div class="content-note">
  <p>Calendar of outages, or spreadsheet-like view of outages.</p>
  <p>
    By default you're seeing the list of outages that affect the CIs you're watching, that happen in the next two weeks.
  </p>
</div>

<div class="content-note">
  Filters Allow the user to limit the outages displayed on the grid or in the calendar. Outages displayed must match EACH of the 3 criteria below.
  <br/>
  The page will be refreshed when any of the following are changed
</div>

<%= form_with url: "#",
      local: true,
      method: :get do |f| %>
  <div class="row form-group">
    <%= label_tag "frag", class: "col col-form-label" do %>
      Fragment
      <%= text_field_tag "frag",
            params.fetch(:frag, session[:frag]),
            class: "form-control" %>
    <% end %>
    <%= label_tag "earliest", class: "col col-form-label" do %>
      Outages After
      <%= date_field_tag "earliest",
        session[:earliest] || default_earliest.to_s(:browser),
        class: "form-control" %>
    <% end %>
    <%= label_tag "latest", class: "col col-form-label" do %>
      Outages Before
      <%= date_field_tag "latest", nil, class: "form-control" %>
    <% end %>
    <div class="col form-group">
      <div class="form-check">
        <%= label_tag :watching,
              value: "Interested",
              class: "col-form-label form-check-label" do %>
          <%= radio_button_tag :watching,
                "Of interest to me",
                params[:watching].blank? ||
                  params[:watching] == "Of interest to me",
                class: "form-check-input" %> Of interest to me
        <% end %>
      </div>
      <div class="form-check">
        <%= label_tag :watching,
              value: "All",
              class: "col-form-label form-check-label" do %>
          <%= radio_button_tag :watching,
                "All",
                params[:watching] == "All",
                class: "form-check-input" %> All
        <% end %>
      </div>
    </div>
  </div>

  <div class="content-note">
    Still not sure that this would be "logically" clear to users (because it is a bit of an "AND/OR". Wondering if this should simply be 'all' or 'watched/edited by me' radio button)
  </div>


  <%= button_tag "Refresh", class: "btn btn-primary" %>

  <div class="content-note">
    <p>
      If an earliest time is provided, show outages that don't end before the earliest time. If the earliest time is blank, outage end time is a don't care.
    </p>
    <p>
      If a latest time is provided, show outages that don't start after the end_time. If the latest time is blank, the outage start time is a don't care.
    </p>
    <p>
      If both times are provided, show the intersection of the above, or actually, do both of the above tests in the same query.
    </p>
    <p>
      Or to put it another way, show all outages that overlap the filter's start and end times.
    </p>
  </div>

<% end %>

<div role="tabpanel" class="outages">
  <div class="border rounded">
    <div>
      <ul class="nav nav-pills">
        <%# FIXME: how to set the active pill for each page? %>
        <li class="nav-item">
          <%= link_to "Grid", outages_path, class: "nav-link" %>
        </li>
        <li class="nav-item">
          <%= link_to "Day", day_outages_path, class: "nav-link" %>
        </li>
        <li class="nav-item">
          <%= link_to "4-Day", fourday_outages_path, class: "nav-link" %>
        </li>
        <li class="nav-item">
          <%= link_to "Week", week_outages_path, class: "nav-link" %>
        </li>
        <li class="nav-item">
          <%= link_to "Month", month_outages_path, class: "nav-link" %>
        </li>
      </ul>
    </div>
    <div>
      <%= yield :outages_view %>
    </div>
  </div>

  <div class="border rounded outages-grid">
    <%= render partial: "grid" %>
  </div>
</div>
<p>
  <% if current_user.can_edit_outages? %>
  <%= link_to "Add Outage", new_outage_path, class: "btn btn-secondary" %>
  <% end %>
</p>

<div class="content-note">
  <hr>
  <h4>Notes, Issues, Questions, Futures</h4>
  <ul>
    <li>
      <strong>
        Problem: Entering a blank date causes this page to fail
      </strong>
    </li>

    <li>
      There are at least 3 options for long lists:
      <ul>
        <li>An intermediate page with the whole list (overlay)</li>
        <li>Max height plus scroll bar</li>
        <li>Jump to Outages page, where whole list is displayed.</li>
      </ul>
    </li>
    <li>
      What option might there be for the calendar? Presumably the calendar may be scrolled back and forth through time - but what options will there for the period of time displayed? Will these be user preferences or will we default to showing weeks and
      the weeks displayed cover the period of time set by the filter above?
    </li>
    <li>
      Likely should add a filter for Completed
    </li>
    <li>Filters: Show me what's changed (TBC)</li>
    <li>Maybe more filters?</li>
    <li>
      Should remember the filters for each user so when they come back to the page, whether it is this session or a new session, the filter will be the same
    </li>
    <li>
      Need to design a graceful way to handle the situations where the user sets filters to return too much data (paging?), or the calendar range is set so long as to return a ridiculous number of weeks (max before today, max after today as limits?)
    </li>
    <li>
      Outages that have an active, on-line notification will be highlighted somehow (bold or backgroun colour?).
    </li>
    <li>
      Future: Preference to automatically mark as read and notifications that too old.
    </li>
  </ul>
</div>
